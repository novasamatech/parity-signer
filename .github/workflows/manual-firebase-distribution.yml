name: Manual Firebase distribution

concurrency:
  group: ${{ github.workflow }}-${{ github.ref }}
  cancel-in-progress: true

on:
  # workflow_dispatch:
  #    inputs:
  #     firebase_group:
  #       description: 'Firebase group'
  #       required: true
  #       default: dev-team
  #     branch:
  #       description: 'From which branch the application will be built'
  #       required: true
  #       default: develop
  push:
    branches:
      - add-firebase

jobs:
  run_tests:
    name: Run tests
    uses: ./.github/workflows/reusable-android-tests.yml 
  build_apk:
    name: Build APKs
    uses: ./.github/workflows/reusable-android-build.yml
    with:
      is-release: false
  upload_apk:
    runs-on: ubuntu-latest
    needs: [run_tests, build_apk]
    steps:
      # - uses: actions/checkout@v4
      - name: Download built artifacts
        uses: actions/download-artifact@v4
        with:
          name: polkadot-vault-apk
          path: app
      - name: Upload debug apk to Firebase
        uses: ./.github/workflows/upload-to-firebase
        with:
          appId: ${{ secrets.ANDROID_FIREBASE_APP_ID }}
          firebase-token: ${{ secrets.ANDROID_FIREBASE_CREDENTIAL_FILE_CONTENT }}
          releaseNotes: ${{ github.event.head_commit.message }}
          #test-groups: ${{ github.event.inputs.firebase_group }}
          test-groups: dev-team
          upload-file: app/android-debug.apk
