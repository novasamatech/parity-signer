package io.parity.signer.models

import android.graphics.BitmapFactory
import androidx.compose.ui.graphics.ImageBitmap
import androidx.compose.ui.graphics.asImageBitmap
import org.json.JSONArray
import org.json.JSONObject

/**
 * Decodes from hex string into number array
 */
fun String.decodeHex(): ByteArray {
	return chunked(2).map { it.toInt(16).toByte() }.toByteArray()
}

/**
 * Encodes number array into string
 */
fun ByteArray.encodeHex(): String {
	return this.joinToString(separator = "") { byte -> "%02x".format(byte) }
}

/**
 * Concatenator for JSON arrays
 * TODO: should abomination not be needed in final version
 */
fun concatJSONArray(vararg arrays: JSONArray): JSONArray {
	var result = JSONArray()
	for (array in arrays) {
		for (i in 0 until array.length()) {
			result.put(array.getJSONObject(i))
		}
	}
	return result
}

/**
 * Sorter for transaction cards
 */
fun sortCards(array: JSONArray): JSONArray {
	var sortable = emptyList<JSONObject>()
	for(i in 0 until array.length()) {
		sortable += array.getJSONObject(i)
	}
	return JSONArray(sortable.sortedBy { item -> item.getInt("index") } )
}

/**
 * Sorter for history
 */
fun sortHistory(array: JSONArray): JSONArray {
	var sortable = emptyList<JSONObject>()
	for(i in 0 until array.length()) {
		sortable += array.getJSONObject(i)
	}
	return JSONArray(sortable.sortedBy{ item -> item.getInt("index") }.reversed() )
}

/**
 * Specialized tool to decode png images generated by rust code
 */
fun String.intoImageBitmap(): ImageBitmap {
	val picture = this.decodeHex()
	return BitmapFactory.decodeByteArray(picture, 0, picture.size).asImageBitmap()
}
